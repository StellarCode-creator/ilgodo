<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ì¹´ì¹´ì˜¤ ì§€ë„ Â· ê²€ìƒ‰ + ì§€ì í¸ì§‘ë„ + ê³ ë„ í‘œì‹œ Â· ìœ„ì„±/ì¼ë°˜ ì „í™˜</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {height:100%; margin:0;}
    #map {width:100%; height:100vh;}

    .control-box{
      position:absolute; top:14px; left:14px;
      background:#fff; border:1px solid #d1d5db; border-radius:10px;
      padding:8px; box-shadow:0 6px 18px rgba(0,0,0,.12);
      z-index:1000; display:flex; gap:8px; align-items:center; flex-wrap:wrap;
      font:14px system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    .btn {appearance:none; border:1px solid #cbd5e1; background:#fff; color:#111827;
      padding:7px 12px; border-radius:8px; cursor:pointer;}
    .btn.active {background:#2563eb; border-color:#1d4ed8; color:#fff;}

    /* ê²€ìƒ‰ ë°•ìŠ¤ (ìƒë‹¨ ì¤‘ì•™) */
    .search-wrap{
      position:absolute; top:14px; left:50%; transform:translateX(-50%);
      z-index:1000; width:min(720px, calc(100% - 28px));
      display:flex; gap:6px;
    }
    #searchInput{
      flex:1; height:40px; padding:0 12px; font-size:14px;
      border:1px solid #d1d5db; border-radius:10px; outline:none; background:#fff;
      box-shadow:0 6px 18px rgba(0,0,0,.06);
    }
    #searchBtn{ min-width:80px; }

    .panel {
      position:absolute; bottom:16px; left:50%; transform:translateX(-50%);
      background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      padding:12px 14px; box-shadow:0 8px 24px rgba(0,0,0,.08);
      z-index:1000; max-width:min(720px, 92vw);
      font:14px system-ui,-apple-system,Segoe UI,Roboto,Arial; line-height:1.4;
    }
    .rows {display:grid; grid-template-columns: 100px 1fr; gap:6px 10px; margin-top:6px;}
    .mono {font-family:ui-monospace, Menlo, Consolas, monospace;}
    .muted {color:#6b7280;}
    .copy-btn{border:1px solid #d1d5db; background:#fff; border-radius:6px; padding:4px 8px; cursor:pointer;}
    .copy-btn:hover{background:#f3f4f6;}
  </style>
</head>
<body>
  <!-- ì¢Œì¸¡ ìƒë‹¨: ì§€ë„ íƒ€ì…/ì§€ì  í† ê¸€ -->
  <div class="control-box">
    <button id="btnRoadmap" class="btn active" title="ì¼ë°˜ì§€ë„">ì¼ë°˜ì§€ë„</button>
    <button id="btnSkyview" class="btn" title="ìœ„ì„±ì§€ë„(ìŠ¤ì¹´ì´ë·°)">ìœ„ì„±ì§€ë„</button>
    <button id="toggleCadastral" class="btn" title="ì§€ì í¸ì§‘ë„ í† ê¸€">ì§€ì í¸ì§‘ë„</button>
  </div>

  <!-- ìƒë‹¨ ì¤‘ì•™: ê²€ìƒ‰ -->
  <div class="search-wrap">
    <input id="searchInput" type="text" placeholder="ì£¼ì†Œë‚˜ ì¥ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: ì œì£¼ì‹œ ì‚¼ì–‘ì¼ë™ 1516)">
    <button id="searchBtn" class="btn">ê²€ìƒ‰</button>
  </div>

  <div id="map"></div>

  <!-- í•˜ë‹¨ ì •ë³´ íŒ¨ë„ -->
  <div class="panel" id="infoPanel">
    <div><strong id="addrTitle">ì£¼ì†Œ: -</strong></div>
    <div class="rows">
      <div class="muted">ì¢Œí‘œ</div>
      <div class="mono" id="coords">-</div>
      <div class="muted">í•´ë°œê³ ë„</div>
      <div id="elev">-</div>
    </div>
    <div style="margin-top:8px;">
      <button class="copy-btn" id="copyBtn">ë‚´ìš© ë³µì‚¬</button>
      <span class="muted" id="status" style="margin-left:8px;">ì§€ë„ë¥¼ í´ë¦­í•˜ê±°ë‚˜, ê²€ìƒ‰í•´ ë³´ì„¸ìš”.</span>
    </div>
  </div>

  <script>
    let map, geocoder, places, marker, cadastralOn = false;

    function initMap(){
      map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(33.5035, 126.5757),
        level: 6,
        mapTypeId: kakao.maps.MapTypeId.ROADMAP
      });
      geocoder = new kakao.maps.services.Geocoder();
      places   = new kakao.maps.services.Places();

      // ì§€ë„ í´ë¦­ â†’ ì£¼ì†Œ/ì¢Œí‘œ/ê³ ë„
      kakao.maps.event.addListener(map, 'click', async (mouseEvent)=>{
        const latlng = mouseEvent.latLng;
        const lat = latlng.getLat(), lng = latlng.getLng();
        placeMarker(lat, lng);
        // ì£¼ì†Œ(ì§€ë²ˆ ìš°ì„ )
        geocoder.coord2Address(lng, lat, (result, status)=>{
          const addr = (status === kakao.maps.services.Status.OK && result[0])
                        ? (result[0].address?.address_name || "-") : "-";
          updatePanel(addr, lat, lng);
        });
        await updateElevation(lat, lng);
      });

      // ì§€ë„ íƒ€ì… ì „í™˜
      document.getElementById('btnRoadmap').addEventListener('click', ()=>{
        map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
        setActive('btnRoadmap', 'btnSkyview');
      });
      document.getElementById('btnSkyview').addEventListener('click', ()=>{
        map.setMapTypeId(kakao.maps.MapTypeId.SKYVIEW);
        setActive('btnSkyview', 'btnRoadmap');
      });

      // ì§€ì  ì˜¤ë²„ë ˆì´
      document.getElementById('toggleCadastral').addEventListener('click', ()=>{
        cadastralOn = !cadastralOn;
        const btn = document.getElementById('toggleCadastral');
        if (cadastralOn){
          map.addOverlayMapTypeId(kakao.maps.MapTypeId.USE_DISTRICT);
          btn.classList.add('active');
        } else {
          map.removeOverlayMapTypeId(kakao.maps.MapTypeId.USE_DISTRICT);
          btn.classList.remove('active');
        }
      });

      // ê²€ìƒ‰ ë²„íŠ¼ & ì—”í„°
      document.getElementById('searchBtn').addEventListener('click', handleSearch);
      document.getElementById('searchInput').addEventListener('keypress', (e)=>{
        if(e.key === 'Enter') handleSearch();
      });

      // ë‚´ìš© ë³µì‚¬
      document.getElementById('copyBtn').addEventListener('click', async ()=>{
        const addr = document.getElementById('addrTitle').textContent.replace(/^ì£¼ì†Œ:\s*/, '');
        const coords = document.getElementById('coords').textContent;
        const elev = document.getElementById('elev').textContent.replace(/\s+/g,' ');
        try{
          await navigator.clipboard.writeText(`ì£¼ì†Œ: ${addr}\nì¢Œí‘œ: ${coords}\ní•´ë°œê³ ë„: ${elev}`);
          setStatus('ë³µì‚¬ ì™„ë£Œ');
        }catch{ setStatus('ë³µì‚¬ ì‹¤íŒ¨'); }
      });
    }

    function setActive(onId, offId){
      document.getElementById(onId).classList.add('active');
      document.getElementById(offId).classList.remove('active');
    }

    // ğŸ” ê²€ìƒ‰ ë¡œì§: Places(í‚¤ì›Œë“œ) â†’ ì—†ìœ¼ë©´ Geocoder(ì£¼ì†Œ)ë¡œ ë³´ì™„
    function handleSearch(){
      const q = document.getElementById('searchInput').value.trim();
      if(!q){ setStatus('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }

      setStatus('ê²€ìƒ‰ ì¤‘â€¦');
      places.keywordSearch(q, async (results, status)=>{
        if(status === kakao.maps.services.Status.OK && results.length){
          const r = results[0]; // ì²« ê²°ê³¼ ì‚¬ìš©
          const lat = parseFloat(r.y), lng = parseFloat(r.x);
          map.setCenter(new kakao.maps.LatLng(lat, lng));
          map.setLevel(4);
          placeMarker(lat, lng);
          // ì£¼ì†Œ ë³´ê°•(ì¥ì†Œëª…ë§Œ ìˆëŠ” ê²½ìš°)
          let addr = r.road_address_name || r.address_name || r.place_name || '-';
          if (!addr) {
            geocoder.coord2Address(lng, lat, (res, st)=>{
              if(st===kakao.maps.services.Status.OK && res[0]){
                addr = res[0].address?.address_name || '-';
                updatePanel(addr, lat, lng);
              }
            });
          }
          updatePanel(addr, lat, lng);
          await updateElevation(lat, lng);
          setStatus(`"${q}" ê²€ìƒ‰ ì™„ë£Œ`);
        }else{
          // í‚¤ì›Œë“œê²€ìƒ‰ ì‹¤íŒ¨ â†’ ì£¼ì†Œ ì§€ì˜¤ì½”ë”© ì‹œë„
          geocoder.addressSearch(q, async (res, st)=>{
            if(st === kakao.maps.services.Status.OK && res[0]){
              const lat = parseFloat(res[0].y), lng = parseFloat(res[0].x);
              const addr = res[0].address?.address_name || res[0].road_address?.address_name || q;
              map.setCenter(new kakao.maps.LatLng(lat, lng));
              map.setLevel(4);
              placeMarker(lat, lng);
              updatePanel(addr, lat, lng);
              await updateElevation(lat, lng);
              setStatus(`"${q}" ì£¼ì†Œ ê²€ìƒ‰ ì™„ë£Œ`);
            }else{
              setStatus('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
          });
        }
      }, { size: 5 }); // ìƒìœ„ 5ê°œê¹Œì§€ë§Œ ê²€ìƒ‰(ìš°ë¦¬ëŠ” ì²« ê²°ê³¼ ì‚¬ìš©)
    }

    function placeMarker(lat, lng){
      const pos = new kakao.maps.LatLng(lat, lng);
      if (marker) marker.setMap(null);
      marker = new kakao.maps.Marker({ position: pos, map });
    }

    function updatePanel(address, lat, lng){
      document.getElementById('addrTitle').textContent = `ì£¼ì†Œ: ${address}`;
      document.getElementById('coords').textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
    }

    async function updateElevation(lat, lng){
      try{
        setStatus('ê³ ë„ ì¡°íšŒ ì¤‘â€¦');
        const resp = await fetch(`https://api.open-elevation.com/api/v1/lookup?locations=${lat},${lng}`);
        const data = await resp.json();
        const elev = (data.results && data.results[0] && data.results[0].elevation != null)
                      ? Number(data.results[0].elevation).toFixed(1) : null;
        document.getElementById('elev').innerHTML = elev ? `<b>${elev} m</b>` : 'ì•Œ ìˆ˜ ì—†ìŒ';
        setStatus('ì™„ë£Œ');
      }catch(e){
        document.getElementById('elev').textContent = 'ì¡°íšŒ ì‹¤íŒ¨';
        setStatus('ê³ ë„ ì¡°íšŒ ì‹¤íŒ¨');
      }
    }

    function setStatus(t){ document.getElementById('status').textContent = t; }
  </script>

  <!-- Kakao Maps JS SDK (services/places í¬í•¨) -->
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=42dc5c20b9646d660d10067eaca438de&libraries=services&autoload=false"
    onload="kakao.maps.load(initMap)">
  </script>
</body>
</html>
